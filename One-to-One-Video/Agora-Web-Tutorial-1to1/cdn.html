<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>CDN StartLiveStreaming</title>
  <link rel="stylesheet" href="./assets/common.css">
  <link rel="stylesheet" href="./vendor/toastify.min.css">
</head>

<body>
  <div class="sections-container">
    <div class="section-container">
      <div class="section-body">
        <div class="notice"></div>
        <div class="section-title">
          <div class="title" id="basic">CDN StartLiveStreaming</div>
          <hr/>
        </div>
        <!-- form -->
        <form id="form">
          <div class="section-form">
            <div class="form-row">
              <div class="form-item">
                <label for="appID">APPID: </label>
                <input placeholder="Enter APPID" type="text" id="appID" name="appID"/>
              </div>
              <div class="form-item">
                <label for="channel">Channel: </label>
                <input placeholder="Enter Channel" type="text" id="channel" name="channel"/>
              </div>
              <div class="form-item">
                <label for="uid">UID: </label>
                <input placeholder="Enter UID" type="text" id="uid" name="uid"/>
              </div>
              <div class="form-item">
                <label for="token">Token: </label>
                <input placeholder="Enter Token" type="text" id="token" name="token"/>
              </div>
              <div class="form-item">
                <label for="microphoneId">Audio Device: </label>
                <select id="microphoneId" name="microphoneId" class="custom-select">
                </select>
              </div>
              <div class="form-item">
                <label for="cameraId">Video Device: </label>
                <select id="cameraId" name="cameraId" class="custom-select">
                </select>
              </div>
              <div class="form-item">
                <label for="resolution">CDN Resolution: </label>
                <select id="resolution" name="resolution" class="custom-select">
                </select>
              </div>
            </div>
            <div class="form-row-one">
              <div class="form-item">
                <label for="url">CDN Url: </label>
                <input class="one-row" placeholder="Enter URL" type="text" id="url" name="url"/>
              </div>
            </div>
            <hr/>
            <div class="form-row button-list">
              <a class="btn" id="create">create channel</a>
              <a class="btn" id="startLiveStreaming">startLiveStreaming</a>
              <a class="btn" id="stopLiveStreaming">stopLiveStreaming</a>
              <a class="btn leave" id="leave">leave</a>
            </div>
            <hr/>
            <div class="video-grid" id="video">
              <div id="local_stream" class="video-placeholder">
                <div id="local_video_info" class="video-info"></div>
              </div>
            </div>
          </div>
        </form>
        <!-- from -->
      </div>
    </div>
  </div>
  <script src="vendor/jquery.js"></script>
  <script src="vendor/toastify.js"></script>
  <script src="assets/AgoraRTCSDK.min.js"></script>
  <script src="assets/common.js"></script>
  <script>
    $(function () {
      var rtc = {
        client: null,
        joined: false,
        published: false,
        localStream: null,
        remoteStreams: [],
        data: {}
      }

      var selects = null;

      getDevices(function (devices) {
        selects = devices;
        devices.audios.forEach(function (audio) {
          $('<option/>', {
            value: audio.value,
            text: audio.name,
          }).appendTo("#microphoneId");
        })
        devices.videos.forEach(function (video) {
          $('<option/>', {
            value: video.value,
            text: video.name,
          }).appendTo("#cameraId");
        })
        selects.resolutions = [
          {
            value: "180p", name: "resolution: 320x180 15fps 140kbps"
          },
          {
            value: "360p", name: "resolution: 640x360 30fps 400kbps"
          },
          {
            value: "720p", name: "resolution: 1280x720 24fps 1130kbps"
          }
        ]
        selects.resolutions.forEach(function (resolution) {
          $('<option/>', {
            value: resolution.value,
            text: resolution.name,
          }).appendTo("#resolution");
        })
      })

      var fields = ['appID', 'channel', 'uid', 'url'];

      $("#create").on("click", function () {
        console.log("create")
        var params = serializeFormData();
        if (validator(params, fields)) {
          join(rtc, params);
        }
      })

      $("#startLiveStreaming").on("click", function () {
        console.log("startLiveStreaming")
        var params = serializeFormData();
        if (validator(params, fields)) {
          startLiveStreaming(rtc);
        }
      });

      $("#stopLiveStreaming").on("click", function () {
        console.log("stopLiveStreaming")
        var params = serializeFormData();
        if (validator(params, fields)) {
          stopLiveStreaming(rtc);
        }
      });

      $("#leave").on("click", function () {
        console.log("leave")
        var params = serializeFormData();
        if (validator(params, fields)) {
          leave(rtc);
        }
      })
    })
  </script>
</body>

</html>